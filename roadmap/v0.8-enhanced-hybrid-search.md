# v0.8: Enhanced Hybrid Search

**Theme**: Richer retrieval without an LLM — auto-embedded vectors in RRF, plus new retrieval signals.

v0.1 shipped BM25 keyword scoring with Reciprocal Rank Fusion. v0.7 added MiniLM auto-embedding. v0.8 connects them: shadow vector collections participate in hybrid search alongside BM25, and new retrieval signals (recency, metadata boosting, graph proximity) make results meaningfully better.

---

## MiniLM Vectors in RRF

Auto-embedded shadow collections feed into the existing hybrid search pipeline as a new signal alongside BM25 keyword scoring.

- `_system_kv`, `_system_json`, `_system_event` collections participate in RRF
- No user configuration — if auto-embed is enabled, vectors are automatically included in hybrid search
- RRF weight for vector signal is tunable (default: equal weight with BM25)

### Before (v0.1)

```
query → BM25 keyword scoring → RRF → results
```

### After (v0.8)

```
query → BM25 keyword scoring  ─┐
      → MiniLM vector search  ─┤→ RRF → results
      → Recency weighting     ─┤
      → Metadata boosting     ─┤
      → Graph proximity       ─┘
```

---

## New Retrieval Signals

### Recency Weighting

Boost more recent data in search results. Useful for agent workloads where recent context is more relevant.

- Configurable decay function (linear, exponential, or step)
- Based on `updated_at` timestamps already stored on all primitives
- Optional per-query override: `db.search("query", SearchOptions { recency_weight: 0.3 })`

### Metadata Boosting

Boost results that match specific metadata criteria, independent of text/vector relevance.

- Uses the existing 8-operator metadata filter infrastructure (shipped in v0.4)
- Soft boost (increase score) vs. hard filter (exclude non-matching) — both supported
- Example: boost results tagged with `priority: high` without excluding `priority: low`

### Graph Proximity

Boost results that are closely connected to the query context in the internal knowledge graph.

- Results with more graph connections to the query context rank higher
- Example: searching for a KV entry also boosts related events and JSON documents

---

## Internal Knowledge Graph

Cross-primitive relationship structure that powers graph proximity scoring. Internal to `strata-intelligence`, not a public primitive.

### What it tracks

- **Shared keys**: KV entry `user:123` is related to event with `payload.user_id = 123`
- **Temporal proximity**: entities created/modified within the same time window
- **Embedding similarity**: entities whose auto-embeddings are near each other
- **Branch lineage**: which branch was forked from which

### What it is NOT

- Not a graph database. No Cypher, no SPARQL, no public API.
- Not NetworkX. No pagerank, no community detection.
- Internal backing structure — like an inverted index backs text search.

### Open questions

- **Edge population**: Inferred automatically or registered explicitly by internal callers?
- **Persistence**: Persisted, or rebuilt on startup from existing primitives?
- **Representation**: Adjacency list, CSR, or something else?
- **Scale**: How many edges per branch is realistic? Determines if in-memory is viable.

---

## Dependencies

- v0.7 (auto-embedding — MiniLM shadow vectors are the primary new signal)

## Key files

| Area | Files |
|------|-------|
| Hybrid search | `crates/intelligence/src/` |
| RRF scoring | `crates/intelligence/src/` |
| Shadow collections | `crates/engine/src/primitives/vector/store.rs` |
