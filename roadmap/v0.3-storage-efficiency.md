# v0.3: Storage Efficiency

**Theme**: Production-grade storage management.

v0.1 prioritized correctness over space efficiency. The WAL grows unbounded, snapshots aren't compressed, and retention policies exist but aren't wired to garbage collection. v0.3 makes StrataDB viable for long-running production workloads.

## Features

### Automatic WAL Compaction

Automatically consolidate and clean up WAL segments after snapshots capture their state.

- WAL segment infrastructure exists in `crates/durability/src/wal/`
- Compaction module exists in `crates/durability/src/compaction/` with `WalOnlyCompactor`
- `CompactMode` enum already defines `Full`, `Incremental`, `DryRun`
- Need: trigger compaction automatically after snapshots, expose via `Compact` command

### Snapshot Compression

Compress snapshot files to reduce disk usage.

- Snapshot format defined in `crates/durability/src/format/snapshot.rs`
- `StorageCodec` trait in `crates/durability/src/codec/` already abstracts encoding
- `IdentityCodec` is the current implementation -- add `ZstdCodec` alongside it
- zstd is already a workspace dependency (used for branch bundles)

### Retention Policy Enforcement

Wire existing retention policies to actual garbage collection.

- `RetentionPolicy` trait exists in `crates/durability/src/retention/` with `KeepAll`, `KeepLast`, `KeepFor`, `Composite` variants
- `RetentionApply`, `RetentionStats`, `RetentionPreview` commands exist in the executor
- Need: background GC task that applies the configured policy, deleting old snapshots and WAL segments

### Tombstone Cleanup

Process and remove tombstones left by delete operations.

- `TombstoneIndex` exists in `crates/durability/src/compaction/tombstone.rs`
- `TombstoneReason` enum tracks why entries were deleted
- Need: periodic sweep that removes tombstones older than the oldest live snapshot

### Storage Metrics

Expose storage statistics for monitoring and capacity planning.

- `Info` command exists but returns minimal data
- Add: WAL size, snapshot count/size, per-branch storage usage, compaction stats
- Wire into the `DatabaseInfo` output type

## Context

Without storage management, a production StrataDB instance will consume unbounded disk space. These features are prerequisite for any real deployment.

## Dependencies

None -- builds on v0.1 durability infrastructure.
