# v1.0: Stable Release

**Theme**: Storage, engine, and stability. Optimize what's proven, then freeze it.

v1.0 is where Strata gets production-grade storage management and commits to backwards compatibility. On-disk formats and public APIs become stable. Breaking changes require major version bumps.

---

## Storage Efficiency

The WAL grows unbounded, snapshots aren't compressed, and retention policies exist but aren't wired to garbage collection. v1.0 fixes all of this.

| Feature | Description | Existing infrastructure |
|---------|-------------|------------------------|
| **WAL compaction** | Auto-consolidate WAL segments after snapshots | `CompactMode` enum, `WalOnlyCompactor` in `crates/durability/src/compaction/` |
| **Snapshot compression** | Zstd-compress snapshot files | `StorageCodec` trait in `crates/durability/src/codec/`, zstd already a workspace dep |
| **Retention enforcement** | Background GC applying configured policies | `RetentionPolicy` trait with `KeepAll`/`KeepLast`/`KeepFor`/`Composite` variants |
| **Tombstone cleanup** | Sweep tombstones older than oldest live snapshot | `TombstoneIndex` in `crates/durability/src/compaction/tombstone.rs` |

## Engine Optimizations

Data-driven rewrites based on benchmark results. Known areas to watch:

- ShardedStore concurrency scaling
- WAL write serialization under high core counts
- Memory allocation pressure on constrained devices
- Vector search performance vs. collection size

## Performance Benchmarks

Published, reproducible baselines.

- Benchmark suite covering all primitives (KV throughput, event append rate, vector search latency)
- Comparison benchmarks against SQLite, redb, LMDB
- Published results in docs with hardware specifications
- CI regression detection (alert on >10% throughput drop)
- **Target**: Ephemeral mode achieves 100K+ ops/sec for KV get/put on commodity hardware

## Stable On-Disk Format

Guarantee that databases created with v1.0 can be read by all future 1.x releases.

- Freeze WAL record format (currently `WAL_RECORD_FORMAT_VERSION`)
- Freeze snapshot format (currently `SNAPSHOT_FORMAT_VERSION`)
- Freeze manifest format (currently `MANIFEST_FORMAT_VERSION`)
- Document the binary format specification

## Semver Commitment

Formal semantic versioning on the public API.

- `pub use strata_executor::*` defines the public surface
- Audit all public types, methods, and traits for stability
- Mark experimental features with `#[doc(hidden)]` or feature flags
- CI check for accidental API breakage via `cargo-semver-checks`

## Comprehensive Fuzz Testing

- Fuzz the command parser (arbitrary `Command` inputs)
- Fuzz the WAL reader (corrupt/malformed WAL segments)
- Fuzz the snapshot reader (corrupt/malformed snapshots)
- Integrate with `cargo-fuzz` and run in CI

## Migration Tooling

- `stratadb migrate` command to upgrade database files
- Dry-run mode to verify migration without modifying data
- Rollback support (backup before migration)

---

## Dependencies

- v0.5-v0.14 should substantially ship before v1.0
